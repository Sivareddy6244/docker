FROM artifactory-saas.mtb.com/mtb-dacsker-ga/mtb-ubi8-openjdk21.0.3.53

USER root

# Strip problematic file attributes (fix for Kaniko "security.capability" issue)
RUN setcap -r /usr/bin/newgrp 2>/dev/null || true && \
    setcap -r /usr/bin/passwd 2>/dev/null || true

RUN apt-get update -y && \
    apt-get install -y ca-certificates unzip && \
    update-ca-certificates

COPY liquibase-5.0.1.tar.gz .

RUN mkdir -p /opt/liquibase && \
    tar -xzf liquibase-5.0.1.tar.gz -C /opt/liquibase && \
    ln -s /opt/liquibase/liquibase /usr/local/bin/liquibase && \
    rm liquibase-5.0.1.tar.gz

ENV PATH="/opt/liquibase:${PATH}"

WORKDIR /workspace

CMD ["liquibase", "--version"]
